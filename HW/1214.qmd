---
title: "1130作業_人口組"
date: 2022-12-11
author:
- 109204005 社會三 劉人瑜
- 109204018 社會三 李彩瑄
- 109204025 社會三 劉采葳
- 109204035 社會三 黃楷捷
format: 
  html: 
    toc: true
    toc-title: Contents
    toc-location: body
    page-layout: full
    code-overflow: wrap
editor: visual
---

```{r,message = FALSE}
options(digits = 3)
library(dplyr)
library(haven)
library(data.table)
tscs212 <- read_dta('../../../HW/tscs212.dta') |> setDT()
tscs212 <- as_factor(tscs212, levels = "default")
```

## 年齡

### 全國

```{r}
ageSet <- tscs212 [!(a2y %in% c('拒答', '不知道')), ]
ageSet[, a2y := as.numeric(as.character(a2y))][, age := 110 - a2y]
ageSet$age <- 110 - as.numeric(ageSet$a2y)
ageSet$ageGroups <- cut(ageSet$age,
                        breaks = c(10, 20, 30, 40, 50, 60, 70, 80, 90, Inf),
                        labels = c('18-20', '21-30', '31-40', '41-50', '51-60',
                                   '61-70', '71-80', '81-90', '超過90'))
prop.table(table(ageSet$ageGroups))*100
```

### 六都

```{r}
ageSet <- (ageSet[a4acity %in% c('臺北市', '臺中市', '高雄市'), .(groupsCount = .N), by = .(a4acity, ageGroups)]
                 [, groupsFreq := groupsCount / sum(groupsCount), by = .(a4acity)]
                 [, .(groupsFreq = groupsFreq * 100), keyby = .(a4acity, ageGroups)])
dcast(ageSet, a4acity ~ ageGroups,
      value.var = 'groupsFreq')
```

## 投票

### 全國

```{r}
opt <- (table(tscs212$j28) |> data.frame())[, 1]
voteSet <- tscs212 [!(j28 %in% opt[7:10]), ]
voteSet[, .(投票率 = sum(j28 %in% opt[1:5]) / sum(j28 %in% opt[1:6]),
            宋楚瑜得票率 = sum(j28 %in% opt[1]) / sum(j28 %in% opt[1:5]),
            韓國瑜得票率 = sum(j28 %in% opt[2]) / sum(j28 %in% opt[1:5]),
            蔡英文得票率 = sum(j28 %in% opt[3]) / sum(j28 %in% opt[1:5]))]
```

### 六都

```{r}
(voteSet[a4acity %in% c('臺北市', '臺中市', '高雄市'),
         .(投票率 = sum(j28 %in% opt[1:5]) / sum(j28 %in% opt[1:6]),
           宋楚瑜得票率 = sum(j28 %in% opt[1]) / sum(j28 %in% opt[1:5]),
           韓國瑜得票率 = sum(j28 %in% opt[2]) / sum(j28 %in% opt[1:5]),
           蔡英文得票率 = sum(j28 %in% opt[3]) / sum(j28 %in% opt[1:5])), by = .(a4acity)])
```

```{r}
data.frame(縣市 = c('臺北市', '臺中市', '高雄市'),
           投票率 = c(76.31, 76.36, 77.44),
           宋楚瑜得票率 = c(4.34, 4.99, 3.14), 
           韓國瑜得票率 = c(42.01, 38.06, 34.63), 
           蔡英文得票率 = c(53.64, 56.95, 62.23))
```
